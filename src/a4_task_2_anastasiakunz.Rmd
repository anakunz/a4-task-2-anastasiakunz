---
title: 'Bonanza Creek Snowshoe Hares: Exploratory Report'
author: "Anastasia Kunz"
date: "11/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(effsize)
library(broom)
library(palmerpenguins)
library(ggbeeswarm)
library(kableExtra)
library(here)
library(lubridate)
```

# Bonanza Creek Snowshoe Hares: Exploratory Report
 Anastasia Kunz
 
```{r}
# Read in data
hare_data <- read_csv(here("data", "bonanza_hares.csv"))
```
 
## 1. Overview
This report explores analysis of population dynamics of an important keystone species, the Snowshoe hare(*Lepus americanus*) in central Alaska at Bonanza Creek Long Term Ecological Research (LTER). Specifically, this capture-recapture study looked to monitor the 8-11yr population fluctuations through different(3????) trap locations and physical specimen metrics including sex, weight, age, and hindfoot length. Relationships between hare sex, weight and hindfoot length is explored in this study.#####Bonanza Creek includes multiple specific habitat types including riparian, black spruce and XXXXXX###


## 2. Data and Analysis
Senior Investigator Knut Kielland as well as Primary Investigators Stuart Chapin and Roger Ruess collected and authored the Snowshoe hare dataset through the Bonanza Creek LTER^1^. The snowshoe hare data used in this analysis includes information about the trap location and ID, as well as individual metrics about the observed specimen including weight, sex, age, and hindfoot length through capture-recapture trapping. Preliminary analysis explores visualization of total hare populations per year. Next, this analysis depicts hare counts by sex at each of three trapping sites; riparian boreal forest, black spruce boreal forest, and mature boreal forest. After these preliminary population visualizations, this report explores basic sample population statistics as well as analysis of Cohen's d effect size and a two sample t-test comparing difference in means using a significance level ($\alpha$). Next this analysis displays the relationship between juvenile hare weight and hindfoot length through a simple linear regression. All analyses are in R version 4.0.2 using RStudio version 1.3.1073.



Possible map and figure?? maybe

## 3. Exploratory Findings
### A. Annual juvenile hare trap counts

```{r}
#filter for juvenile hares and create year out of date column
juvenile_hare_yr <- hare_data %>% 
  filter(age == "j") %>% 
  mutate(date_converted = mdy(date)) %>% 
  mutate(year = year(date_converted))%>% 
  count(year)

# create visualization
ggplot(juvenile_hare_yr, aes(x = year, y = n)) +
  geom_col(size = 2, fill = "dodgerblue2") +
  theme_bw()+
  labs(
    x = "Year",
    y = "Juvenile Hare Count",
    title = "Total Juvenile Hares Per Year",
    subtitle = "1998 - 2012"
  )
  
```

**Figure 1.** Total juvenile hares recorded per year at all sites. 

In 1999 we see the most juvenile hares trapped with a maximum count of 126 juvenile hares. However in two years, 2002 and 2009, there was a minimum count value where no juvenile hares were observed. The trend in Figure 1. shows a steep overall decline in juvenile hare populations, with semi-consistent yearly fluctuations. It is important to note the consistency of days each year that hares were recorded. In some years there are significantly more days in which data is recorded than in other years. For example, only 19 observations were recorded in 2002 with only 3 observations including age. Similarly, age of the hares is inconsistently reported, so it is difficult to comment on population trends without age assessment of the hares that were trapped. In addition, duplicate individuals were recorded both between traps as well as observation duplication. For better total count analysis, there should be consistency in the number of trapping days and number of traps set. 

### B. Visualize Juvenille Hare Weights

```{r}
#juvenile hare weight by sex and site 
juvenile_hare_weight <- hare_data %>% 
  filter(age == "j")

grid.labs<- c("Bonanza Black Spruce", "Bonanza Mature", "Bonanza Riparian")
names(grid.labs) <- c("bonbs", "bonmat", "bonrip")

ggplot(juvenile_hare_weight, aes(x = sex, y = weight))+
  geom_boxplot(aes(fill = sex))+
  facet_wrap(~ grid, labeller = labeller(grid = grid.labs))+
  theme_bw()+
  labs(
    x = "Sex",
    y = "Weight (g)",
    title = "Juvenile Weight by Sex at Each Site",
    subtitle = "1998 - 2012"
  )+
  scale_x_discrete(labels=c("f" = "Female", "m" = "Male",
                              "NA" = "NA"))+
  theme(legend.position = "none")
```

**Figure 2.** Box and whisker plot showing female, male and NA weight. FIX THIS CAPTION


### C. Juvenile Weight Comparison (Male & Female)

**Table 1.**  CAPTION HERE LOOK UP HOW TO GET aligned
```{r}
#compare mean weights for juvenile male and female hares in the study: table with mean stdev and sample size 
mf_hare_weight<- juvenile_hare_weight %>% 
  filter(sex == "f" | sex == "m") %>% 
  mutate(sex_new = case_when(
    sex == "m" ~ "Male",
    sex == "f" ~ "Female"
  )) %>% 
  group_by(sex_new) %>% 
  summarize(mean_g = mean(weight, na.rm = TRUE),
            standard_deviation = sd(weight, na.rm = TRUE),
            sample_size = n())
mf_hare_weight %>% 
  kable(col.names = c("Sex", "Mean Weight (g)", "Standard Deviation (g)", "Sample Size")) %>% 
  kable_styling(full_width = FALSE)
  
  
```



```{r}
# T-Test Code

m_hare <- juvenile_hare_weight %>% 
  filter(sex == "m") %>% 
  pull(weight)

f_hare_na <-juvenile_hare_weight %>% 
  filter(sex == "f") %>% 
  pull(weight)

f_hare <- na.omit(f_hare_na)

```


```{r, include = FALSE}
#Exploratory Graphs
hist(m_hare) #looks pretty normal
hist(f_hare) #looks pretty normal too
qqnorm(m_hare) #bit of a curve, but overall pretty normal too
qqnorm(f_hare) #normal

# Main Takeaways: Generally normal, no glaring issues. The male hare weight distribution is perhaps a little off from a normal distribution, but a t-test should suffice for mean weight comparison.

hare_ttest <- t.test(m_hare, f_hare)

# Get the tidy model results to call outputs in-line: 
hare_ttest_tidy <- tidy(hare_ttest)

# hare_ttest_tidy

# Find  means and std dev 
m_weight_mean <- mean(m_hare)
f_weight_mean <- mean(f_hare)
m_weight_sd <- sd(m_hare)
f_weight_sd <- sd(f_hare)

# Cohen's D Effect Size
hare_effsize <- cohen.d(m_hare, f_hare)

```

Juvenile hare mean weight (g) were compared between male and female hares. This statistical analysis shows that when comparing mean juvenile hare weight, males (`r round(mf_hare_weight[2,2], 2)`g, n = `r mf_hare_weight[2,4]`) were larger than females (`r round(mf_hare_weight[1,2], 2)`g, n = `r mf_hare_weight[1,4]`) with an actual difference in means of `r round(mf_hare_weight[2,2]- mf_hare_weight[1,2], 2)`g. This shows a a `r round((mf_hare_weight[2,2] - mf_hare_weight[1,2])/((mf_hare_weight[2,2] + mf_hare_weight[1,2])/2)*100, 2)`% difference. Statistical analysis using a two sample t-test showed this difference to be significant (Welches Two Sample T-Test: t(`r hare_ttest_tidy[1,4]`) p = `r round(hare_ttest_tidy[1,5], 2)`), with a small effect size (Cohen's d = `r round(hare_effsize$estimate, 2)`).

### D. Relationship Between Juvenile Weight and Hind Foot Length

```{r}
ggplot(juvenile_hare_weight, aes(x = hindft, y = weight))+
  geom_point()+
  geom_smooth(method = lm, color = "dodgerblue2")+
  theme_bw()+
  labs(
    x = "Hindfoot Length (mm)",
    y = "Weight (g)",
    title = "Relationship of Snowshoe Hare Weight and Hindfoot Length",
    subtitle = "1998 - 2012"
  )
```

**Figure 3.** CAPTION HERE

outcome of linear regression, sllope interpretation, R2 and pearsons r, what assumptions of linear regression may be a concern. how well or not well linear reg describes relationship. Worries?


## 4. Summary

Overarching summ sentence
  - bullet pts are good here

## 5. Citations

1. Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14











